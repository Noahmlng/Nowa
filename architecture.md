# AI Todo App 软件架构设计

## 整体架构

采用现代化的前后端分离架构，主要分为以下几个部分：

### 1. 前端层
- 使用 Next.js (App Router) + TypeScript 框架构建，提供服务端渲染和静态生成能力
- UI 组件库：shadcn/ui + Radix UI，基于 Tailwind CSS 构建，风格简洁，与 Notion 风格契合
- 拖拽功能：Dnd-kit，专注于实现高质量拖拽体验，能够与 shadcn/ui 无缝集成
- 样式系统：Tailwind CSS + CSS Modules，确保响应式界面
- 状态管理：Zustand，轻量级状态管理库
- 语音处理：初步采用浏览器内置的 Web Speech API 实现基础语音识别
- 使用 React 组件化开发，提高代码复用性和可维护性

### 2. 后端层
- 使用 Next.js API Routes 作为后端服务
- 核心依赖：
  - 语音转文字：RealtimeSTT（本地部署方案，可结合其他开源方案如 Vosk 或 whisper.cpp）
  - 自然语言处理：DeepSeek API（用于解析语音反馈及任务语义分析）
  - 邮件服务：nodemailer（实现任务总结邮件推送）
- 数据库：
  - 开发阶段：SQLite（便于快速原型开发）
  - 生产阶段：迁移至 Supabase（支持更强的扩展性与实时数据功能）
- 身份验证：
  - 采用 JWT + OAuth2 方案，支持 Google、Microsoft 等第三方登录
  - 使用 NextAuth.js 实现统一认证与会话管理
- 实现 RESTful API 接口，处理前端请求

### 3. AI 服务层
- 语音识别服务：RealtimeSTT
- 自然语言处理服务：DeepSeek API，理解用户意图和任务反馈
- 任务调整引擎：结合自定义规则引擎与 DeepSeek 微调模型，根据用户反馈动态调整任务
- 总结生成服务：DeepSeek API

### 4. 数据存储层
- 用户数据：身份信息、偏好设置
- 目标数据：长期目标、关联任务、进度
- 任务数据：任务详情、状态、优先级
- 反馈数据：用户反馈历史、任务调整记录
- 数据库选型：
  - 开发阶段：SQLite
  - 生产阶段：Supabase

### 5. 外部服务集成
- 邮件服务：使用 nodemailer 发送任务总结报告
- 认证服务：NextAuth.js 实现用户登录和身份验证
- 云存储服务：存储用户语音和相关数据

## 组件设计

### 前端组件
1. **认证组件**：处理用户登录和注册，支持第三方登录
2. **目标管理组件**：创建和管理用户长期目标
3. **任务列表组件**：显示和管理日常任务，支持拖拽排序
4. **语音输入组件**：捕获和处理用户语音反馈，使用 Web Speech API
5. **任务总结组件**：展示任务完成情况报告
6. **设置组件**：管理用户偏好和通知设置

### 后端服务
1. **认证服务**：使用 NextAuth.js 处理用户身份验证
2. **目标服务**：管理用户目标数据
3. **任务服务**：处理任务的增删改查
4. **反馈服务**：处理用户反馈并调整任务
5. **总结服务**：生成任务完成情况报告
6. **邮件服务**：使用 nodemailer 发送电子邮件通知

### AI 模块
1. **语音识别模块**：使用 RealtimeSTT 或备选开源方案将语音转换为文本
2. **意图理解模块**：使用 DeepSeek API 分析用户反馈内容
3. **任务调整模块**：根据反馈调整任务参数
4. **数据分析模块**：分析用户行为和任务模式
5. **报告生成模块**：生成个性化任务总结

## 数据流设计

1. **用户目标记录流程**
   - 用户创建/编辑目标 → 前端目标组件 → 后端目标服务 → 数据库存储
   - 数据库 → 后端目标服务 → 前端目标组件 → 用户界面展示

2. **语音反馈任务调整流程**
   - 用户语音输入 → 前端语音组件 → Web Speech API/语音识别模块 → 文本数据
   - 文本数据 → DeepSeek API 意图理解模块 → 任务调整模块 → 后端任务服务
   - 后端任务服务 → 数据库更新 → 前端任务组件 → 用户界面更新

3. **任务总结生成流程**
   - 用户请求总结 → 前端总结组件 → 后端总结服务
   - 后端总结服务 → 数据库查询 → 数据分析模块 → 报告生成模块
   - 报告生成模块 → 后端总结服务 → 前端总结组件/邮件服务 → 用户查看/接收

## API 设计

### 用户认证 API
- `POST /api/auth/register` - 用户注册
- `POST /api/auth/login` - 用户登录
- `GET /api/auth/user` - 获取当前用户信息
- `GET /api/auth/providers` - 获取可用的第三方登录提供商

### 目标管理 API
- `GET /api/goals` - 获取用户所有目标
- `POST /api/goals` - 创建新目标
- `GET /api/goals/:id` - 获取特定目标详情
- `PUT /api/goals/:id` - 更新目标信息
- `DELETE /api/goals/:id` - 删除目标

### 任务管理 API
- `GET /api/tasks` - 获取用户所有任务
- `POST /api/tasks` - 创建新任务
- `GET /api/tasks/:id` - 获取特定任务详情
- `PUT /api/tasks/:id` - 更新任务信息
- `DELETE /api/tasks/:id` - 删除任务
- `PUT /api/tasks/reorder` - 更新任务顺序（支持拖拽排序）

### 反馈处理 API
- `POST /api/feedback/voice` - 提交语音反馈
- `POST /api/feedback/text` - 提交文本反馈
- `GET /api/feedback/history` - 获取反馈历史

### 总结报告 API
- `GET /api/summary/today` - 获取今日总结
- `POST /api/summary/email` - 通过邮件发送总结
- `GET /api/summary/history` - 获取历史总结报告

## 安全设计

1. **认证安全**
   - 使用 JWT (JSON Web Tokens) + OAuth2 进行身份验证
   - 实现 HTTPS 加密传输
   - 密码加盐哈希存储
   - 使用 NextAuth.js 管理认证流程

2. **数据安全**
   - 用户数据加密存储
   - 实现数据访问控制
   - 定期数据备份

3. **API 安全**
   - 实现请求速率限制
   - 防止 CSRF 和 XSS 攻击
   - 输入验证和净化

## 部署与扩展

### 部署策略
1. **初期部署**
   - 快速搭建开发环境，利用 SQLite 与 Next.js API Routes 验证核心功能
   
2. **后续扩展**
   - 迁移至 Supabase，提升数据库管理及实时推送能力
   - 根据业务需求，可考虑前后端完全分离，并引入独立的微服务架构

### 扩展思路
1. **模块替换与优化**
   - 语音识别模块可根据实际需求灵活切换至 Vosk、whisper.cpp 等方案
   - 自定义规则引擎与 AI 模型根据用户反馈不断迭代与优化

2. **监控与日志**
   - 添加系统日志、错误监控和用户行为分析模块，保障系统稳定性

3. **用户体验**
   - 持续优化前端 UI 及交互体验，确保拖拽、表单、弹窗等操作流畅自然