# AI 任务建议与详细计划功能

## 功能概述

AI 任务建议与详细计划功能是 Nowa 应用的核心功能之一，它利用人工智能技术为用户提供个性化的任务建议和详细的执行计划。该功能包括两个主要部分：

1. **任务建议生成**：基于用户的任务标题、个人资料和历史反馈，生成 3 个个性化的任务建议选项。
2. **详细计划生成**：当用户选择一个建议后，系统会生成包含执行逻辑、注意事项、时间线和子任务的详细计划。

## 技术实现

### 后端 API

该功能通过两个主要的 API 端点实现：

1. `/api/suggestions`：生成任务建议
   - 输入：任务标题、用户资料、历史反馈
   - 输出：3 个个性化的任务建议

2. `/api/plan`：生成详细计划
   - 输入：任务标题、选定的建议、用户资料、历史反馈
   - 输出：包含标题、描述、时间线和子任务的详细计划

### 前端组件

前端实现主要包括以下组件：

1. `TaskSuggestions.tsx`：显示 AI 生成的建议和详细计划
2. `TaskDetail.tsx`：任务详情页面，包含时间线显示

## 数据结构

### 任务建议

```typescript
string[] // 建议数组，每个元素是一个建议字符串
```

### 详细计划

```typescript
interface DetailedPlan {
  title: string;                 // 计划标题
  description: string;           // 计划描述（包含方案逻辑和注意事项）
  subtasks: Subtask[];           // 子任务列表
  timeline?: TimelinePhase[];    // 时间线（可选）
}

interface Subtask {
  id: string;                    // 子任务 ID
  title: string;                 // 子任务标题
  completed: boolean;            // 完成状态
}

interface TimelinePhase {
  phase: string;                 // 阶段名称
  duration: string;              // 持续时间
  description: string;           // 阶段描述
}
```

## 使用流程

1. 用户点击任务卡片上的 AI 按钮
2. 系统显示 3 个个性化的任务建议
3. 用户选择一个建议
4. 系统生成并显示详细计划，包括：
   - 计划标题和描述
   - 执行时间线（各阶段及持续时间）
   - 子任务列表
5. 用户可以应用该计划到任务中

## 提示工程

系统使用精心设计的提示模板与 DeepSeek AI 模型交互：

1. **建议生成提示**：包含用户画像、任务上下文和输出格式要求
2. **详细计划提示**：包含用户画像、任务上下文、所选建议和结构化输出要求

## 未来改进

1. 增加更多个性化参数，如用户的历史完成情况和偏好
2. 添加计划调整功能，允许用户在应用前修改计划
3. 实现计划执行跟踪和进度可视化
4. 基于执行结果提供反馈和改进建议

## 示例

### 任务建议示例

```
1. 需要恢复吗？做轻度训练
2. 想增强核心吗？尝试平板支撑
3. 关节不适吗？试试瑜伽拉伸
```

### 详细计划示例

```markdown
## 髋关节恢复训练计划

### 方案逻辑
本计划针对髋关节不适设计，采用渐进式恢复训练，结合低强度活动和针对性拉伸，帮助缓解疼痛并逐步恢复关节功能。

### 注意事项
- ❗ 训练过程中如果疼痛加剧，立即停止
- ❗❗ 确保每个动作都在舒适范围内完成，不要过度拉伸

### 时间线
1. 缓解期（3-5天）：以舒缓疼痛为主，每天进行轻度活动
2. 恢复期（1-2周）：逐步增加活动强度，加入针对性训练
3. 强化期（2-3周）：增强周围肌肉群，提高关节稳定性

### 子任务清单
- [ ] 热身 5 分钟（轻度有氧）
- [ ] 髋关节轻柔活动（每侧 10 次）
- [ ] 髋部肌肉拉伸（保持 30 秒，每侧 3 组）
- [ ] 核心稳定训练（2 组，每组 30 秒）
- [ ] 放松整理（5 分钟）
```

## 相关文件

- `src/app/api/suggestions/route.ts`：任务建议 API
- `src/app/api/plan/route.ts`：详细计划 API
- `src/components/TaskSuggestions.tsx`：任务建议 UI 组件
- `src/components/TaskDetail.tsx`：任务详情组件（包含时间线显示）
- `src/store/store.ts`：数据存储（包含 Task 和 TimelinePhase 接口） 